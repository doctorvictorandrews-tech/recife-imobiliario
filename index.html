<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Recife Imobili√°rio: V28 Deluxe</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rye&family=Poppins:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --wood-dark: #3e2723; --wood-light: #5d4037;
            --paper: #fff8e1; --gold: #ffca28;
            --frevo-blue: #0288d1; --frevo-red: #c62828; --frevo-green: #2e7d32;
            --shadow-high: 0 30px 60px rgba(0,0,0,0.8);
        }
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; font-family: 'Poppins', sans-serif; 
            background: radial-gradient(circle at center, #81d4fa, #01579b);
            height: 100vh; overflow: hidden; display: flex; flex-direction: column; 
        }
        h1, h2, h3, .brand { font-family: 'Rye', serif; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); }

        /* --- LAYOUT DO JOGO --- */
        #game-stage { display: flex; width: 100%; height: 100%; }
        
        /* 1. VIEWPORT 3D (C√ÇMERA) */
        #viewport { 
            flex: 1; perspective: 1200px; display: flex; 
            align-items: center; justify-content: center; overflow: hidden; 
            position: relative;
        }
        
        /* O TABULEIRO */
        #board-container {
            transform-style: preserve-3d; transition: transform 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        #board {
            display: grid; grid-template-columns: repeat(11, 90px); grid-template-rows: repeat(11, 90px);
            background: #f5f5f5; border: 20px solid var(--wood-dark); border-radius: 15px;
            box-shadow: 0 50px 100px #000; position: relative; transform-style: preserve-3d;
            background-image: url('https://www.transparenttextures.com/patterns/white-brick-wall.png');
        }

        /* CASAS DO TABULEIRO */
        .space {
            border: 1px solid rgba(0,0,0,0.1); background: rgba(255,255,255,0.95);
            font-size: 0.6rem; text-align: center; position: relative; 
            display: flex; flex-direction: column; backface-visibility: hidden;
        }
        .color-strip { height: 15px; border-bottom: 2px solid #333; }
        .sp-icon { font-size: 1.5rem; margin-top: 2px; }
        .sp-name { font-weight: bold; line-height: 1; flex: 1; display: flex; align-items: center; justify-content: center; padding: 0 2px; }
        .sp-price { background: #eee; font-weight: bold; font-family: 'Rye'; font-size: 0.7rem; color: #333; border-top: 1px solid #ccc; }

        /* CENTRO (DECK & LOGO) */
        .center-hub { 
            grid-column: 2/11; grid-row: 2/11; background: #e1f5fe; border: 5px solid var(--wood-dark); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            position: relative; overflow: hidden; 
        }
        .frevo-bg { 
            position: absolute; width: 200%; height: 200%; opacity: 0.1; 
            background: conic-gradient(red, yellow, green, blue, red); 
            animation: spin 30s linear infinite; 
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* DECK 3D NO CENTRO */
        .deck-stack {
            position: absolute; width: 60px; height: 90px; background: #fff;
            border: 2px solid #333; border-radius: 5px; box-shadow: 5px 5px 0 #333;
            background-image: repeating-linear-gradient(45deg, #c62828 0, #c62828 10px, #fff 10px, #fff 20px);
            cursor: pointer; transition: 0.2s;
        }
        .deck-stack::before { content:'‚ùì'; font-size: 2rem; display: grid; place-items: center; height: 100%; color: #fff; text-shadow: 2px 2px 0 #000; }
        .deck-pos { bottom: 20px; right: 20px; transform: rotate(-10deg); }

        /* PE√ïES */
        .token {
            width: 40px; height: 40px; position: absolute; z-index: 100; font-size: 3rem;
            text-align: center; line-height: 40px; filter: drop-shadow(0 10px 5px rgba(0,0,0,0.5));
            transition: all 0.3s ease; transform-origin: bottom center; pointer-events: none;
        }
        
        /* 2. SIDEBAR (CONTROLES E INVENT√ÅRIO) */
        #sidebar { 
            width: 380px; background: var(--paper); border-left: 10px solid var(--wood-dark);
            display: flex; flex-direction: column; padding: 15px; box-shadow: -20px 0 50px rgba(0,0,0,0.5);
            z-index: 200;
        }
        
        .hud-header { text-align: center; border-bottom: 2px dashed #999; padding-bottom: 10px; margin-bottom: 10px; }
        .turn-box { background: #333; color: var(--gold); padding: 5px 15px; border-radius: 20px; font-weight: bold; display: inline-block; font-family: 'Rye'; }

        /* INVENT√ÅRIO (MINI CARDS 3D) */
        #inventory-area { 
            flex: 1; background: rgba(0,0,0,0.05); border: 2px solid var(--wood-light); border-radius: 8px;
            padding: 10px; overflow-y: auto; margin-bottom: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; align-content: start;
        }
        .mini-card {
            background: #fff; border: 1px solid #000; padding: 5px; border-radius: 4px; font-size: 0.7rem;
            display: flex; align-items: center; box-shadow: 2px 2px 0 rgba(0,0,0,0.2); cursor: pointer; transition: 0.2s;
        }
        .mini-card:hover { transform: scale(1.05); z-index: 10; }
        .mini-color { width: 10px; height: 20px; margin-right: 5px; border: 1px solid #333; }

        /* BOT√ïES TEM√ÅTICOS */
        .btn-recife { 
            width: 100%; padding: 15px; margin-bottom: 8px; border: 3px solid #000; border-radius: 50px;
            font-family: 'Rye'; font-size: 1rem; text-transform: uppercase; cursor: pointer; color: white;
            box-shadow: 0 5px 0 rgba(0,0,0,0.3); transition: 0.1s; position: relative; overflow: hidden;
        }
        .btn-recife:active { transform: translateY(4px); box-shadow: 0 0 0; }
        .btn-recife:disabled { background: #999 !important; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.6; }

        /* 3. OVERLAYS E ANIMA√á√ïES */
        #overlay-layer { position: fixed; inset: 0; pointer-events: none; z-index: 5000; display: flex; justify-content: center; align-items: center; }
        
        /* CARTA DE PROPRIEDADE 3D */
        .prop-card-3d {
            width: 300px; background: #fff; border: 8px solid var(--wood-dark); border-radius: 15px;
            padding: 20px; text-align: center; pointer-events: auto; transform: scale(0); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 30px 60px rgba(0,0,0,0.8); display: none; position: relative;
        }
        .prop-card-3d.show { transform: scale(1); display: block; }
        .pc-header { background: #333; color: white; padding: 10px; font-family: 'Rye'; font-size: 1.5rem; margin: -20px -20px 15px -20px; }
        .pc-img { font-size: 4rem; display: block; margin: 10px 0; }
        .pc-info { text-align: left; font-size: 0.9rem; margin: 10px 0; border: 1px dashed #ccc; padding: 10px; background: #f9f9f9; }
        .pc-price { font-size: 2rem; color: var(--frevo-green); font-weight: 900; font-family: 'Rye'; }

        /* CARTA DE SORTE VOANDO */
        #flying-card {
            width: 200px; height: 300px; position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%) rotateY(90deg); transition: 1s;
            transform-style: preserve-3d; opacity: 0; pointer-events: auto;
        }
        #flying-card.fly { opacity: 1; transform: translate(-50%, -50%) rotateY(0deg) scale(1.2); }
        
        .fc-face {
            position: absolute; inset: 0; backface-visibility: hidden; border-radius: 10px; border: 4px solid #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 10px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); background: #fff;
        }
        .fc-back { background-image: repeating-linear-gradient(45deg, #c62828 0, #c62828 10px, #fff 10px, #fff 20px); transform: rotateY(180deg); }
        .fc-front { background: var(--paper); transform: rotateY(0deg); }

        /* DADOS 3D */
        .dice-stage { display: flex; gap: 40px; perspective: 800px; pointer-events: none; opacity: 0; transition: 0.3s; }
        .dice-stage.active { opacity: 1; }
        .cube { width: 80px; height: 80px; position: relative; transform-style: preserve-3d; transition: transform 1.5s ease-out; }
        .face { position: absolute; inset: 0; background: #fff; border: 4px solid #000; border-radius: 12px; display: grid; place-items: center; font-size: 2.5rem; font-weight: bold; }
        .f1{transform:translateZ(40px)} .f6{transform:rotateX(180deg) translateZ(40px)}
        .f2{transform:rotateY(-90deg) translateZ(40px)} .f5{transform:rotateY(90deg) translateZ(40px)}
        .f3{transform:rotateX(-90deg) translateZ(40px)} .f4{transform:rotateX(90deg) translateZ(40px)}
        .r1{transform:rotateX(0) rotateY(0)} .r6{transform:rotateX(180deg)} .r2{transform:rotateY(90deg)} .r5{transform:rotateY(-90deg)} .r3{transform:rotateX(-90deg)} .r4{transform:rotateX(90deg)}

        /* LOBBY */
        #screen-lobby { position: fixed; inset: 0; z-index: 9000; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        .char-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 30px 0; }
        .char-opt { border: 2px solid #fff; padding: 15px; border-radius: 15px; cursor: pointer; transition: 0.3s; text-align: center; }
        .char-opt:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }

    </style>
</head>
<body>

<canvas id="rain-canvas"></canvas>

<div id="screen-lobby">
    <h1 style="font-size:4rem; color:var(--gold); margin:0;">RECIFE DE LUXO</h1>
    <p>Escolha sua fantasia para o galo:</p>
    <div class="char-grid" id="char-grid"></div>
</div>

<div id="game-stage">
    <div id="viewport">
        <div id="board-container">
            <div id="board">
                <div class="center-hub">
                    <div class="frevo-bg"></div>
                    <h1 style="z-index:2; color:var(--frevo-blue); font-size:3.5rem; text-shadow:2px 2px #fff; margin:0;">RECIFE</h1>
                    <div class="deck-stack deck-pos"></div>
                </div>
                </div>
        </div>
    </div>

    <div id="sidebar">
        <div class="hud-header">
            <div class="turn-box" id="turn-display">VEZ DE: ...</div>
            <h2 style="color:var(--frevo-green); margin:5px 0;">Sua Carteira: <span id="my-cash">$1500</span></h2>
        </div>

        <h3 style="color:#666; margin:0 0 5px 0;">Suas Escrituras:</h3>
        <div id="inventory-area">
            <div style="color:#999; grid-column:span 2; text-align:center;">Vazio... Compre algo!</div>
        </div>

        <div style="margin-top:auto;">
            <button id="b-roll" class="btn-recife" style="background:var(--gold); color:black;" onclick="game.roll()">üé≤ ROLAR DADOS</button>
            <button id="b-pass" class="btn-recife" style="background:var(--frevo-red);" onclick="game.pass()" disabled>üõë PASSAR A VEZ</button>
        </div>
    </div>
</div>

<div id="overlay-layer">
    
    <div class="dice-stage" id="dice-stage">
        <div id="d1" class="cube"><div class="face f1">1</div><div class="face f2">2</div><div class="face f3">3</div><div class="face f4">4</div><div class="face f5">5</div><div class="face f6">6</div></div>
        <div id="d2" class="cube"><div class="face f1">1</div><div class="face f2">2</div><div class="face f3">3</div><div class="face f4">4</div><div class="face f5">5</div><div class="face f6">6</div></div>
    </div>

    <div id="prop-card" class="prop-card-3d">
        <div class="pc-header" id="pc-name">Nome da Rua</div>
        <div class="pc-img" id="pc-icon">üè†</div>
        <div class="pc-price" id="pc-price">$200</div>
        <div class="pc-info" id="pc-rent">
            Aluguel: $10<br>
            Com 1 Casa: $50<br>
            Com Hotel: $500
        </div>
        <button class="btn-recife" style="background:var(--frevo-green);" onclick="game.buyAction()">COMPRAR</button>
        <button class="btn-recife" style="background:#666; margin-top:5px;" onclick="ui.closeCard()">N√ÉO QUERO</button>
    </div>

    <div id="flying-card">
        <div class="fc-face fc-front">
            <h2 style="color:var(--frevo-blue); font-family:'Rye';" id="fc-title">SORTE</h2>
            <p style="font-size:1.2rem; font-weight:bold;" id="fc-text">Ganhou na loteria!</p>
            <button class="btn-recife" style="width:auto; padding:5px 20px; margin-top:20px; background:#333;" onclick="ui.closeFly()">OK</button>
        </div>
        <div class="fc-face fc-back"></div>
    </div>

</div>

<script>
/* --- DADOS --- */
const CHARS=[{id:'c',i:'ü¶Ä',n:'Caranguejo'},{id:'s',i:'ü¶à',n:'Tubar√£o'},{id:'u',i:'‚òÇÔ∏è',n:'Sombrinha'},{id:'sol',i:'‚òÄÔ∏è',n:'Sol'}];
const CARDS={
    luck: ["Achou 50 conto no ch√£o! (+50)", "Ganhou rifa do Galo! (+100)", "Vendeu √°gua no sinal. (+20)"],
    bad: ["Multa de tr√¢nsito. (-50)", "Perdeu a carteira. (-20)", "Caiu no buraco da rua. (-100)"]
};
// Mapa (t:type, n:name, p:price, g:color, i:icon)
const BD=[
    {t:'st',n:'In√≠cio',i:'üö©'}, 
    {t:'pr',n:'Coque',p:60,g:'#795548',i:'üèöÔ∏è',r:[2,10,30,90,160]}, {t:'ch',n:'Sorte',i:'üçÄ'}, {t:'pr',n:'Ibura',p:60,g:'#795548',i:'‚õ∞Ô∏è',r:[4,20,60,180,320]}, {t:'tx',n:'IPTU',p:200,i:'üí∏'}, {t:'rr',n:'Metr√¥',p:200,i:'üöÜ'}, {t:'pr',n:'Sto Amaro',p:100,g:'#03a9f4',i:'üè¢',r:[6,30,90,270,400]}, {t:'ch',n:'Rev√©s',i:'‚ö†Ô∏è'}, {t:'pr',n:'Afogados',p:100,g:'#03a9f4',i:'üåä',r:[6,30,90,270,400]}, {t:'pr',n:'Mustardinha',p:120,g:'#03a9f4',i:'üèòÔ∏è',r:[8,40,100,300,450]},
    {t:'jl',n:'Cadeia',i:'üëÆ'}, 
    {t:'pr',n:'Iputinga',p:140,g:'#e91e63',i:'üéì',r:[10,50,150,450,750]}, {t:'ut',n:'Luz',p:150,i:'üí°'}, {t:'pr',n:'Cordeiro',p:140,g:'#e91e63',i:'üêÇ',r:[10,50,150,450,750]}, {t:'pr',n:'V√°rzea',p:160,g:'#e91e63',i:'üå≥',r:[12,60,180,500,700]}, {t:'rr',n:'Metr√¥ Oeste',p:200,i:'üöÜ'}, {t:'pr',n:'Imbiribeira',p:180,g:'#ff5722',i:'üè≠',r:[14,70,200,550,750]}, {t:'ch',n:'Sorte',i:'üçÄ'}, {t:'pr',n:'Encruzilhada',p:180,g:'#ff5722',i:'‚õ™',r:[14,70,200,550,750]}, {t:'pr',n:'Torre',p:200,g:'#ff5722',i:'üåÉ',r:[16,80,220,600,800]},
    {t:'pk',n:'Parque',i:'üé°'}, 
    {t:'pr',n:'Aflitos',p:220,g:'#d32f2f',i:'üèüÔ∏è',r:[18,90,250,700,875]}, {t:'ch',n:'Rev√©s',i:'‚ö†Ô∏è'}, {t:'pr',n:'Espinheiro',p:220,g:'#d32f2f',i:'üå≥',r:[18,90,250,700,875]}, {t:'pr',n:'Madalena',p:240,g:'#d32f2f',i:'üè°',r:[20,100,300,750,925]}, {t:'rr',n:'Via Mangue',p:200,i:'üõ£Ô∏è'}, {t:'pr',n:'Gra√ßas',p:260,g:'#fbc02d',i:'üè´',r:[22,110,330,800,975]}, {t:'pr',n:'Po√ßo',p:260,g:'#fbc02d',i:'üè∫',r:[22,110,330,800,975]}, {t:'ut',n:'√Ågua',p:150,i:'üíß'}, {t:'pr',n:'Casa Forte',p:280,g:'#fbc02d',i:'üè∞',r:[24,120,360,850,1025]},
    {t:'gj',n:'Blitz',i:'üöì'}, 
    {t:'pr',n:'Apipucos',p:300,g:'#388e3c',i:'üå≤',r:[26,130,390,900,1100]}, {t:'pr',n:'Parnamirim',p:300,g:'#388e3c',i:'‚õ™',r:[26,130,390,900,1100]}, {t:'ch',n:'Sorte',i:'üçÄ'}, {t:'pr',n:'Paiva',p:320,g:'#388e3c',i:'üåâ',r:[28,150,450,1000,1200]}, {t:'rr',n:'Aeroporto',p:200,i:'‚úàÔ∏è'}, {t:'ch',n:'Rev√©s',i:'‚ö†Ô∏è'}, {t:'pr',n:'Boa Viagem',p:350,g:'#1565c0',i:'üèñÔ∏è',r:[35,175,500,1100,1300]}, {t:'tx',n:'Taxa',p:100,i:'üßæ'}, {t:'pr',n:'Jaqueira',p:400,g:'#1565c0',i:'üå≥',r:[50,200,600,1400,1700]}
];

let players = [
    {name:"Voc√™", icon:"", pos:0, money:1500, jailed:false, id:0},
    {name:"CPU", icon:"ü§ñ", pos:0, money:1500, jailed:false, id:1}
];
let props = Array(40).fill(null); // {owner:0, level:0}
let turn = 0;
let rolled = false;

/* --- ENGINE VISUAL --- */
const ui = {
    init: () => {
        const g = document.getElementById('char-grid');
        CHARS.forEach(c => {
            g.innerHTML += `<div class="char-opt" onclick="ui.startGame('${c.i}')"><span style="font-size:3rem">${c.i}</span><br>${c.n}</div>`;
        });
    },
    startGame: (icon) => {
        players[0].icon = icon;
        document.getElementById('screen-lobby').style.display='none';
        ui.buildBoard();
        ui.updateHUD();
    },
    buildBoard: () => {
        const b = document.getElementById('board');
        BD.forEach((s, i) => {
            const d = document.createElement('div');
            d.className = 'space'; d.id = `s${i}`;
            // Grid Logic
            let r,c;
            if(i<=10){r=11;c=11-i;} else if(i<=20){r=11-(i-10);c=1;} else if(i<=30){r=1;c=1+(i-20);} else {r=1+(i-30);c=11;}
            d.style.gridRow=r; d.style.gridColumn=c;
            
            // Content
            if(s.t==='pr'){
                d.innerHTML = `<div class="color-strip" style="background:${s.g}"></div><div class="sp-icon">${s.i}</div><div class="sp-name">${s.n}</div><div class="sp-price">$${s.p}</div>`;
            } else {
                d.innerHTML = `<div class="sp-icon" style="margin-top:10px;">${s.i}</div><div class="sp-name">${s.n}</div>`;
            }
            b.appendChild(d);
        });
        
        // Tokens
        players.forEach((p,i)=>{
            const t = document.createElement('div');
            t.className='token'; t.id=`p${i}`; t.innerText=p.icon;
            b.appendChild(t);
            ui.placeToken(i, 0);
        });
    },
    placeToken: (pid, idx) => {
        const t = document.getElementById(`p${pid}`);
        const s = document.getElementById(`s${idx}`);
        // Posicionamento relativo
        t.style.left = (s.offsetLeft + 15 + (pid*10)) + 'px';
        t.style.top = (s.offsetTop + 10 + (pid*10)) + 'px';
        
        // Camera Zoom
        if(pid===0) ui.focusCamera(idx);
    },
    focusCamera: (idx) => {
        // Logica simples de tilt do tabuleiro
        const b = document.getElementById('board-container');
        let rX=35, rZ=0, tX=0, tY=0;
        
        if(idx<=10) { tY=50; rZ=0; }
        else if(idx<=20) { tX=50; rZ=5; }
        else if(idx<=30) { tY=-50; rZ=0; }
        else { tX=-50; rZ=-5; }
        
        b.style.transform = `rotateX(${rX}deg) rotateZ(${rZ}deg) translate(${tX}px, ${tY}px)`;
    },
    updateHUD: () => {
        const p = players[0];
        document.getElementById('turn-display').innerText = `VEZ DE: ${players[turn].name}`;
        document.getElementById('my-cash').innerText = `$${p.money}`;
        
        // Buttons
        const humanTurn = turn===0;
        document.getElementById('b-roll').disabled = !(humanTurn && !rolled);
        document.getElementById('b-pass').disabled = !(humanTurn && rolled);
        
        // Inventory
        const inv = document.getElementById('inventory-area');
        const myProps = props.map((pr, i) => ({pr, i})).filter(x => x.pr && x.pr.owner === 0);
        
        if(myProps.length === 0) inv.innerHTML = '<div style="grid-column:span 2; text-align:center; color:#999">Vazio...</div>';
        else {
            inv.innerHTML = myProps.map(x => {
                const s = BD[x.i];
                return `<div class="mini-card"><div class="mini-color" style="background:${s.g}"></div><b>${s.n}</b></div>`;
            }).join('');
        }
    },
    showCard3D: (idx) => {
        const s = BD[idx];
        const c = document.getElementById('prop-card');
        document.getElementById('pc-name').innerText = s.n;
        document.getElementById('pc-name').style.background = s.g;
        document.getElementById('pc-icon').innerText = s.i;
        document.getElementById('pc-price').innerText = `$${s.p}`;
        document.getElementById('pc-rent').innerHTML = `Base: $${s.r[0]}<br>1 Casa: $${s.r[1]}<br>Hotel: $${s.r[4]}`;
        
        c.classList.add('show');
    },
    closeCard: () => {
        document.getElementById('prop-card').classList.remove('show');
    },
    animFlyCard: (type) => {
        const el = document.getElementById('flying-card');
        const tit = document.getElementById('fc-title');
        const txt = document.getElementById('fc-text');
        
        const list = type==='ch' ? CARDS.luck : CARDS.bad;
        const msg = list[Math.floor(Math.random()*list.length)];
        const val = parseInt(msg.match(/\d+/)[0]);
        const gain = msg.includes('+');
        
        tit.innerText = type==='ch' ? "SORTE!" : "AZAR!";
        tit.style.color = type==='ch' ? 'green' : 'red';
        txt.innerText = msg;
        
        // Animation
        el.classList.add('fly');
        
        // Effect
        setTimeout(()=>{
            if(gain) { players[turn].money += val; confetti(); }
            else players[turn].money -= val;
            ui.updateHUD();
        }, 1000);
    },
    closeFly: () => {
        document.getElementById('flying-card').classList.remove('fly');
    }
};

/* --- LOGICA --- */
const game = {
    roll: async () => {
        const d1 = Math.ceil(Math.random()*6);
        const d2 = Math.ceil(Math.random()*6);
        
        // Dice Anim
        const ds = document.getElementById('dice-stage');
        ds.classList.add('active');
        const c1=document.getElementById('d1'), c2=document.getElementById('d2');
        c1.className='cube'; c2.className='cube'; void c1.offsetWidth;
        setTimeout(()=>{ c1.classList.add(`r${d1}`); c2.classList.add(`r${d2}`); }, 50);
        
        await new Promise(r=>setTimeout(r, 2000));
        ds.classList.remove('active');
        
        await game.move(turn, d1+d2);
        rolled = true;
        ui.updateHUD();
        
        if(turn===1) setTimeout(game.pass, 1000); // CPU auto pass
    },
    move: async (pid, steps) => {
        const p = players[pid];
        for(let i=0; i<steps; i++){
            p.pos++; if(p.pos>=40){ p.pos=0; p.money+=200; }
            ui.placeToken(pid, p.pos);
            await new Promise(r=>setTimeout(r, 200));
        }
        game.land(pid);
    },
    land: (pid) => {
        const p = players[pid];
        const s = BD[p.pos];
        const pr = props[p.pos];
        
        if(s.t==='pr'){
            if(!pr && pid===0){
                // Show Buy Card
                if(p.money >= s.p) ui.showCard3D(p.pos);
            } else if(pr && pr.owner !== pid){
                // Pay Rent
                const r = s.r[pr.level];
                p.money -= r; players[pr.owner].money += r;
                alert(`Pagou aluguel de $${r}`);
            }
        } else if (s.t==='ch' || s.t==='rev'){
            ui.animFlyCard(s.t);
        }
    },
    buyAction: () => {
        const p = players[0];
        const idx = p.pos;
        const s = BD[idx];
        
        p.money -= s.p;
        props[idx] = {owner:0, level:0};
        
        // Visual Border
        document.getElementById(`s${idx}`).style.border = '4px solid red';
        ui.closeCard();
        ui.updateHUD();
        confetti();
    },
    pass: () => {
        turn = (turn+1)%2;
        rolled = false;
        ui.updateHUD();
        if(turn===1) setTimeout(game.roll, 1000);
    }
};

ui.init();
</script>
</body>
</html>
