<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recifeopoly - Vers√£o Corrigida</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; text-align: center; padding: 20px; }
        h1 { color: #2c3e50; }
        
        /* √Årea do Tabuleiro (Visualiza√ß√£o Simples) */
        #tabuleiro {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-width: 800px;
            margin: 20px auto;
        }

        .casa {
            border: 2px solid #bdc3c7;
            background: white;
            padding: 10px;
            border-radius: 8px;
            min-height: 80px;
            font-size: 0.9em;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .casa.propriedade { border-color: #3498db; }
        .casa.especial { border-color: #f1c40f; background-color: #fffbf0; }
        .casa.imposto { border-color: #e74c3c; background-color: #fff0f0; }

        /* Pinos dos Jogadores */
        .pino {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
            margin: 2px;
            border: 1px solid rgba(0,0,0,0.2);
        }

        /* Painel de Controle */
        #controles {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 20px auto;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            margin: 5px;
            transition: background 0.3s;
        }

        .btn-jogar { background-color: #2ecc71; color: white; }
        .btn-jogar:hover { background-color: #27ae60; }
        .btn-jogar:disabled { background-color: #ccc; cursor: not-allowed; }

        .btn-sim { background-color: #3498db; color: white; }
        .btn-nao { background-color: #e74c3c; color: white; }

        #area-decisao { display: none; background-color: #e8f6f3; padding: 15px; border-radius: 5px; margin-top: 10px; }

        /* Logs e Status */
        #status-jogadores { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .card-jogador { background: #fff; padding: 10px; border-radius: 5px; width: 30%; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        #log-jogo {
            height: 150px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            max-width: 600px;
            margin: 0 auto;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .log-msg { margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 2px; }
    </style>
</head>
<body>

    <h1>üè∞ Recifeopoly</h1>

    <div id="status-jogadores">
        </div>

    <div id="tabuleiro">
        </div>

    <div id="controles">
        <h2 id="titulo-vez">Vez de: <span id="nome-jogador-vez">...</span></h2>
        
        <div id="dados-display" style="font-size: 24px; margin: 10px; font-weight: bold;">üé≤ -- | --</div>
        
        <button id="btn-jogar" class="btn-jogar" onclick="jogarDados()">üé≤ Jogar Dados</button>

        <div id="area-decisao">
            <p id="msg-decisao">Deseja comprar esta propriedade?</p>
            <button class="btn-sim" onclick="responderCompra(true)">Sim</button>
            <button class="btn-nao" onclick="responderCompra(false)">N√£o</button>
        </div>
    </div>

    <h3>üìú Hist√≥rico</h3>
    <div id="log-jogo"></div>

<script>
    // ====================================================
    // 1. CONFIGURA√á√ÉO E DADOS
    // ====================================================

    // Configura√ß√£o do Tabuleiro (Corre√ß√µes de nomes aqui)
    const casas = [
        { nome: "Marco Zero", tipo: "inicio", preco: 0 },
        { nome: "Rua da Aurora", tipo: "propriedade", preco: 100, aluguel: 10, dono: null },
        { nome: "Av. Agamenon Magalh√£es", tipo: "propriedade", preco: 200, aluguel: 20, dono: null }, // Antigo Santo Amaro
        { nome: "Ibura", tipo: "propriedade", preco: 120, aluguel: 12, dono: null }, // Ibura (Mantido)
        { nome: "Imbiribeira", tipo: "propriedade", preco: 220, aluguel: 22, dono: null }, // Antiga Agamenon
        { nome: "Galo da Madrugada", tipo: "evento_galo", preco: 0 },
        { nome: "Boa Viagem", tipo: "propriedade", preco: 300, aluguel: 30, dono: null },
        { nome: "Lei Seca", tipo: "imposto", valor: 100 }, // Casa que n√£o d√° pra comprar
        { nome: "Olinda", tipo: "propriedade", preco: 280, aluguel: 28, dono: null },
        { nome: "Cadeia", tipo: "prisao", preco: 0 }
    ];

    let jogadores = [
        { id: 0, nome: "Jogador 1", cor: "blue", saldo: 1500, posicao: 0, preso: false },
        { id: 1, nome: "Jogador 2", cor: "red", saldo: 1500, posicao: 0, preso: false }
        // Adicione mais jogadores se quiser
    ];

    let jogadorAtualIndex = 0;
    let dadosIguais = false; // Controle de dados iguais
    let aguardandoDecisao = false;

    // ====================================================
    // 2. INICIALIZA√á√ÉO VISUAL
    // ====================================================

    function iniciarJogo() {
        renderizarTabuleiro();
        atualizarUI();
        log("Bem-vindo ao Recifeopoly! O jogo come√ßou.");
    }

    function renderizarTabuleiro() {
        const tabuleiroDiv = document.getElementById("tabuleiro");
        tabuleiroDiv.innerHTML = "";
        
        casas.forEach((casa, index) => {
            const div = document.createElement("div");
            div.className = `casa ${casa.tipo === 'propriedade' ? 'propriedade' : (casa.tipo === 'imposto' ? 'imposto' : 'especial')}`;
            div.innerHTML = `<strong>${casa.nome}</strong>`;
            
            // Se for propriedade, mostra pre√ßo
            if(casa.tipo === 'propriedade') {
                div.innerHTML += `<br><small>R$ ${casa.preco}</small>`;
            }
            if(casa.tipo === 'imposto') {
                div.innerHTML += `<br><small>-R$ ${casa.valor}</small>`;
            }

            // Area para pinos
            const pinosDiv = document.createElement("div");
            pinosDiv.id = `casa-${index}-pinos`;
            div.appendChild(pinosDiv);

            tabuleiroDiv.appendChild(div);
        });
        atualizarPinos();
    }

    function atualizarPinos() {
        // Limpa todos os pinos anteriores
        casas.forEach((_, i) => {
            document.getElementById(`casa-${i}-pinos`).innerHTML = "";
        });

        // Desenha os novos
        jogadores.forEach(j => {
            const pino = document.createElement("span");
            pino.className = "pino";
            pino.style.backgroundColor = j.cor;
            document.getElementById(`casa-${j.posicao}-pinos`).appendChild(pino);
        });
    }

    function atualizarUI() {
        const divStatus = document.getElementById("status-jogadores");
        divStatus.innerHTML = "";
        jogadores.forEach(j => {
            divStatus.innerHTML += `
                <div class="card-jogador" style="border-top: 4px solid ${j.cor}">
                    <strong>${j.nome}</strong><br>
                    Saldo: R$ ${j.saldo}<br>
                    ${j.preso ? '<span style="color:red">PRESO</span>' : 'Livre'}
                </div>
            `;
        });

        document.getElementById("nome-jogador-vez").innerText = jogadores[jogadorAtualIndex].nome;
        document.getElementById("nome-jogador-vez").style.color = jogadores[jogadorAtualIndex].cor;
    }

    function log(msg) {
        const logDiv = document.getElementById("log-jogo");
        const linha = document.createElement("div");
        linha.className = "log-msg";
        linha.innerText = `> ${msg}`;
        logDiv.prepend(linha);
    }

    // ====================================================
    // 3. L√ìGICA DO JOGO (CORRIGIDA)
    // ====================================================

    function jogarDados() {
        const btn = document.getElementById("btn-jogar");
        btn.disabled = true; // Trava bot√£o para evitar clique duplo
        
        const d1 = Math.floor(Math.random() * 6) + 1;
        const d2 = Math.floor(Math.random() * 6) + 1;
        const soma = d1 + d2;

        // Verifica dados iguais
        dadosIguais = (d1 === d2);

        document.getElementById("dados-display").innerText = `üé≤ ${d1} + ${d2} = ${soma}`;
        log(`${jogadores[jogadorAtualIndex].nome} tirou ${d1} e ${d2}.`);

        let jogador = jogadores[jogadorAtualIndex];

        // L√≥gica de Pris√£o
        if (jogador.preso) {
            if (dadosIguais) {
                jogador.preso = false;
                log("Sorte! Tirou dados iguais e saiu da pris√£o!");
                moverJogador(jogador, soma);
            } else {
                log("Continua preso. Passa a vez.");
                dadosIguais = false; // Preso n√£o joga de novo se falhar
                finalizarJogada();
            }
        } else {
            moverJogador(jogador, soma);
        }
    }

    function moverJogador(jogador, passos) {
        jogador.posicao += passos;

        // Volta completa
        if (jogador.posicao >= casas.length) {
            jogador.posicao = jogador.posicao % casas.length;
            jogador.saldo += 200;
            log("Passou pelo Marco Zero! Ganhou R$ 200.");
        }

        atualizarPinos();
        atualizarUI();

        // Delay para "andar" visualmente antes de disparar o evento
        setTimeout(() => {
            verificarCasa(jogador);
        }, 500);
    }

    function verificarCasa(jogador) {
        const casa = casas[jogador.posicao];
        log(`Caiu em: ${casa.nome}`);

        // 1. PROPRIEDADE
        if (casa.tipo === "propriedade") {
            if (casa.dono === null) {
                if (jogador.saldo >= casa.preco) {
                    mostrarOpcaoCompra(casa);
                    return; // Retorna para esperar o clique do usu√°rio
                } else {
                    log("Sem saldo para comprar.");
                    finalizarJogada();
                }
            } else if (casa.dono !== jogador.id) {
                // Paga aluguel
                jogador.saldo -= casa.aluguel;
                let dono = jogadores.find(j => j.id === casa.dono);
                if (dono) dono.saldo += casa.aluguel;
                
                log(`Pagou R$ ${casa.aluguel} de aluguel para ${dono ? dono.nome : 'banco'}.`);
                atualizarUI();
                finalizarJogada();
            } else {
                log("Caiu na pr√≥pria casa. Descanso.");
                finalizarJogada();
            }
        }
        // 2. IMPOSTO / LEI SECA (Corre√ß√£o do travamento)
        else if (casa.tipo === "imposto") {
            jogador.saldo -= casa.valor;
            log(`Pagou R$ ${casa.valor} de multa.`);
            atualizarUI();
            finalizarJogada(); // IMPORTANTE: Chama finalizarJogada
        }
        // 3. GALO (Corre√ß√£o: S√≥ teleporta o atual)
        else if (casa.tipo === "evento_galo") {
            log("üêî O GALO PASSOU! Arrast√£o para o Marco Zero!");
            jogador.posicao = 0; // Marco Zero √© index 0
            jogador.saldo += 200;
            atualizarPinos();
            atualizarUI();
            finalizarJogada();
        }
        // 4. PRIS√ÉO
        else if (casa.tipo === "prisao") {
            jogador.preso = true;
            log("Voc√™ foi PRESO! Ficar√° sem jogar at√© tirar dados iguais.");
            dadosIguais = false; // Se foi preso agora, perde o b√¥nus de jogar de novo
            finalizarJogada();
        }
        // 5. IN√çCIO
        else {
            finalizarJogada();
        }
    }

    // ====================================================
    // 4. SISTEMA DE COMPRA
    // ====================================================

    function mostrarOpcaoCompra(casa) {
        aguardandoDecisao = true;
        document.getElementById("area-decisao").style.display = "block";
        document.getElementById("msg-decisao").innerText = `Deseja comprar ${casa.nome} por R$ ${casa.preco}?`;
        // Bot√£o de jogar dados some enquanto decide
        document.getElementById("btn-jogar").style.display = "none";
    }

    function responderCompra(querComprar) {
        if (!aguardandoDecisao) return;

        const casa = casas[jogadores[jogadorAtualIndex].posicao];
        const jogador = jogadores[jogadorAtualIndex];

        if (querComprar) {
            jogador.saldo -= casa.preco;
            casa.dono = jogador.id;
            log(`Comprou ${casa.nome}!`);
            
            // Atualiza visualmente a casa (borda da cor do jogador)
            const casaDiv = document.querySelectorAll(".casa")[jogador.posicao];
            casaDiv.style.borderColor = jogador.cor;
            casaDiv.style.borderWidth = "4px";
            
            atualizarUI();
        } else {
            log("Decidiu n√£o comprar.");
        }

        // Reseta UI de compra
        document.getElementById("area-decisao").style.display = "none";
        aguardandoDecisao = false;

        // CORRE√á√ÉO DO BUG: Mesmo recusando a compra, verifica se joga de novo
        finalizarJogada();
    }

    // ====================================================
    // 5. GERENCIAMENTO DE TURNO (CORRE√á√ÉO DE BUGS)
    // ====================================================

    function finalizarJogada() {
        let jogador = jogadores[jogadorAtualIndex];

        // Se tirou dados iguais e n√£o est√° preso, joga de novo
        if (dadosIguais && !jogador.preso) {
            log(`üé≤üé≤ DADOS IGUAIS! ${jogador.nome} joga novamente!`);
            
            // Destrava o bot√£o para o MESMO jogador
            const btn = document.getElementById("btn-jogar");
            btn.disabled = false;
            btn.style.display = "inline-block";
            
        } else {
            // Passa a vez
            proximoTurno();
        }
    }

    function proximoTurno() {
        jogadorAtualIndex++;
        if (jogadorAtualIndex >= jogadores.length) {
            jogadorAtualIndex = 0;
        }

        const proximo = jogadores[jogadorAtualIndex];
        log(`--- Vez de ${proximo.nome} ---`);
        
        atualizarUI(); // Atualiza o nome de quem joga

        // CORRE√á√ÉO: Apenas libera o bot√£o. NUNCA joga automaticamente.
        const btn = document.getElementById("btn-jogar");
        btn.disabled = false;
        btn.style.display = "inline-block";
        
        if(proximo.preso) {
            log(`${proximo.nome} est√° preso. Precisa de dados iguais.`);
        }
    }

    // Inicia tudo
    window.onload = iniciarJogo;

</script>
</body>
</html>
