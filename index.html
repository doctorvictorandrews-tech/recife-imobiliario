<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco Imobili√°rio Recife - Hard Mode</title>
    <style>
        :root {
            --bg-color: #f0f8ff;
            --panel-bg: #2c3e50;
            --board-bg: #ddeedd;
            --highlight: #f1c40f;
            --text-main: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- TELAS DE SETUP --- */
        #setup-screen, #draft-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .hidden { display: none !important; }

        h1 { margin-bottom: 20px; color: var(--highlight); text-transform: uppercase; letter-spacing: 2px; }
        
        .btn {
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            background: var(--highlight);
            border: none;
            border-radius: 5px;
            font-weight: bold;
            margin: 10px;
            transition: 0.2s;
        }
        .btn:hover { transform: scale(1.05); }
        .btn:disabled { background: #7f8c8d; cursor: not-allowed; }

        .peoes-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        .peao-card {
            background: #ecf0f1;
            color: #333;
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            width: 120px;
        }
        .peao-card:hover { background: #bdc3c7; }
        .peao-icon { font-size: 40px; display: block; margin-bottom: 10px; }

        /* --- JOGO PRINCIPAL --- */
        #game-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* TABULEIRO (Esquerda) */
        #board-area {
            flex: 2;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--board-bg);
        }

        #board-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5x5 grid para 16 casas */
            grid-template-rows: repeat(5, 1fr);
            gap: 5px;
            width: 90vh;
            height: 90vh;
            max-width: 700px;
            max-height: 700px;
            position: relative;
        }

        .tile {
            background: white;
            border: 2px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 5px;
            font-size: 11px;
            text-align: center;
            position: relative;
        }

        .tile-header { width: 100%; height: 15px; margin-bottom: 5px; }
        .tile-name { font-weight: bold; }
        .tile-price { font-size: 10px; color: #555; }
        
        /* Jogadores no tabuleiro */
        .player-token {
            width: 20px; height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            font-size: 12px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        /* PAINEL (Direita) */
        #sidebar {
            flex: 1;
            background: var(--panel-bg);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-left: 5px solid #1a252f;
        }

        #room-code {
            font-size: 24px; color: var(--highlight);
            text-align: center; margin-bottom: 20px;
            border-bottom: 1px solid #7f8c8d; padding-bottom: 10px;
        }

        #player-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .player-card {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 4px solid transparent;
            display: flex; justify-content: space-between; align-items: center;
        }
        .player-card.active { background: rgba(255,215,0,0.2); border-left-color: var(--highlight); }
        .player-card.preso { opacity: 0.7; border-left-color: red; }
        .player-card.falido { text-decoration: line-through; opacity: 0.4; }

        #game-log {
            height: 150px;
            background: rgba(0,0,0,0.3);
            overflow-y: scroll;
            padding: 10px;
            font-size: 12px;
            font-family: monospace;
            margin-bottom: 15px;
            border: 1px solid #7f8c8d;
        }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #444; padding-bottom: 2px; }
        .log-entry.important { color: var(--highlight); font-weight: bold; }

        #controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .dice-display {
            grid-column: span 2;
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
            background: #fff; color: #000;
            padding: 5px; border-radius: 4px;
        }

        /* Modal de A√ß√£o (Comprar/Pagar) */
        #action-modal {
            position: absolute;
            bottom: 20%; left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 20px;
            border: 4px solid var(--panel-bg);
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 50;
            display: none;
        }
        #action-modal h3 { margin-top: 0; color: #333; }
        #action-modal button { margin: 5px; }

    </style>
</head>
<body>

    <div id="setup-screen">
        <h1>Banco Imobili√°rio Recife</h1>
        <p>Edi√ß√£o: Agamenon & Boa Viagem (Hard Mode)</p>
        <div style="margin: 20px;">
            <label style="font-size: 20px;">N√∫mero de Jogadores: <span id="num-display" style="color:var(--highlight)">2</span></label>
            <br><br>
            <input type="range" id="num-slider" min="2" max="8" value="2" oninput="document.getElementById('num-display').innerText = this.value">
        </div>
        <button class="btn" onclick="startGameSetup()">INICIAR DRAFT</button>
    </div>

    <div id="draft-screen" class="hidden">
        <h2 id="draft-title">Jogador 1: Escolha seu Pe√£o</h2>
        <div class="peoes-grid" id="peoes-container">
            </div>
    </div>

    <div id="game-container" class="hidden">
        <div id="board-area">
            <div id="board-grid">
                </div>
            
            <div id="action-modal">
                <h3 id="modal-msg">Mensagem</h3>
                <div id="modal-btns"></div>
            </div>
        </div>

        <div id="sidebar">
            <div id="room-code">SALA: RECIFE00</div>
            
            <div id="player-list">
                </div>

            <div id="game-log">
                <div class="log-entry">Bem-vindo ao Recife!</div>
            </div>

            <div class="dice-display" id="dice-result">Dados: --</div>

            <div id="controls">
                <button id="btn-roll" class="btn" onclick="game.rollDice()">JOGAR DADOS</button>
                <button id="btn-pass" class="btn" onclick="game.nextTurn()" disabled>PASSAR</button>
                <button id="btn-pay" class="btn hidden" onclick="game.payJail()">FIAN√áA (R$50)</button>
                <button id="btn-try" class="btn hidden" onclick="game.tryJailDice()">TENTAR SORTE</button>
            </div>
        </div>
    </div>

<script>
    // --- DADOS DO JOGO ---

    const PEOES = [
        {nome: "Caranguejo", icon: "ü¶Ä", desc: "Manguebeat"},
        {nome: "Tubar√£o", icon: "ü¶à", desc: "Rei de BV"},
        {nome: "Sombrinha", icon: "‚òÇÔ∏è", desc: "Frevo"},
        {nome: "Bolo de Rolo", icon: "üç•", desc: "Patrim√¥nio"},
        {nome: "Galo", icon: "üêî", desc: "Madrugada"},
        {nome: "La Ursa", icon: "üêª", desc: "Quer dinheiro"},
        {nome: "BRT", icon: "üöå", desc: "Lento"},
        {nome: "Caboclo", icon: "üë∫", desc: "Lan√ßa"}
    ];

    // Configura√ß√£o do Tabuleiro (16 casas)
    // Coordenadas Grid (row, col) para loop de 5x5
    // Top: (1,1) a (1,5) | Right: (2,5) a (4,5) | Bottom: (5,5) a (5,1) | Left: (4,1) a (2,1)
    const BOARD_MAP = [
        { id: 0, nome: "MARCO ZERO", tipo: "inicio", preco: 0, cor: "#ccc", grid: "1 / 1" },
        { id: 1, nome: "Rua da Aurora", tipo: "prop", preco: 100, aluguel: 10, cor: "#90EE90", grid: "1 / 2" },
        { id: 2, nome: "Torre Malakoff", tipo: "prop", preco: 120, aluguel: 12, cor: "#90EE90", grid: "1 / 3" },
        { id: 3, nome: "LE√ÉO (IMPOSTO)", tipo: "imposto", preco: 0, cor: "#FF6347", grid: "1 / 4" },
        { id: 4, nome: "Esta√ß√£o Central", tipo: "transporte", preco: 200, aluguel: 25, cor: "#777", grid: "1 / 5" },
        
        { id: 5, nome: "AGAMENON", tipo: "prop", preco: 350, aluguel: 40, cor: "#FFA500", grid: "2 / 5" },
        { id: 6, nome: "Espinheiro", tipo: "prop", preco: 280, aluguel: 28, cor: "#FFA500", grid: "3 / 5" },
        { id: 7, nome: "SORTE/REV√âS", tipo: "sorte", preco: 0, cor: "#EE82EE", grid: "4 / 5" },
        
        { id: 8, nome: "CADEIA (AN√çBAL)", tipo: "cadeia", preco: 0, cor: "#000", grid: "5 / 5", textColor: "white" },
        { id: 9, nome: "Casa Amarela", tipo: "prop", preco: 180, aluguel: 18, cor: "#87CEFA", grid: "5 / 4" },
        { id: 10, nome: "Jaqueira", tipo: "prop", preco: 220, aluguel: 22, cor: "#87CEFA", grid: "5 / 3" },
        { id: 11, nome: "RioMar (Cia)", tipo: "cia", preco: 200, aluguel: 0, cor: "#6495ED", grid: "5 / 2" },
        { id: 12, nome: "BOA VIAGEM", tipo: "prop", preco: 450, aluguel: 55, cor: "#006400", grid: "5 / 1", textColor: "white" },
        
        { id: 13, nome: "Pina", tipo: "prop", preco: 320, aluguel: 35, cor: "#006400", grid: "4 / 1", textColor: "white" },
        { id: 14, nome: "V√Å P/ CADEIA", tipo: "va_cadeia", preco: 0, cor: "#8B0000", grid: "3 / 1", textColor: "white" },
        { id: 15, nome: "Olinda (Alto)", tipo: "prop", preco: 260, aluguel: 26, cor: "#FFC0CB", grid: "2 / 1" }
    ];

    // --- L√ìGICA DO JOGO ---

    const CONFIG = {
        salario: 150,
        fianca: 50,
        impostoRate: 0.10
    };

    let gameState = {
        players: [], // { id, nome, icon, saldo, pos, preso, attempts, falido, props: [], color }
        turnIndex: 0,
        numPlayers: 2,
        draftIndex: 0,
        properties: {}, // id_casa -> id_dono
        waitingAction: false // se true, bloqueia dados at√© resolver (ex: comprar)
    };

    // --- FUN√á√ïES DE SETUP ---

    function startGameSetup() {
        gameState.numPlayers = parseInt(document.getElementById('num-slider').value);
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('draft-screen').classList.remove('hidden');
        renderDraft();
    }

    function renderDraft() {
        const container = document.getElementById('peoes-container');
        container.innerHTML = '';
        document.getElementById('draft-title').innerText = `Jogador ${gameState.draftIndex + 1}: Escolha seu Pe√£o`;

        PEOES.forEach((peao, idx) => {
            const btn = document.createElement('div');
            btn.className = 'peao-card';
            btn.innerHTML = `<span class="peao-icon">${peao.icon}</span>${peao.nome}`;
            btn.onclick = () => selectPeao(idx);
            container.appendChild(btn);
        });
    }

    function selectPeao(idx) {
        const p = PEOES[idx];
        const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#e67e22', '#1abc9c', '#34495e'];
        
        gameState.players.push({
            id: gameState.draftIndex,
            nome: p.nome,
            icon: p.icon,
            saldo: 1000,
            pos: 0,
            preso: false,
            attempts: 0,
            falido: false,
            props: [],
            color: colors[gameState.draftIndex]
        });

        // Remove pe√£o da lista
        PEOES.splice(idx, 1);
        gameState.draftIndex++;

        if (gameState.draftIndex < gameState.numPlayers) {
            renderDraft();
        } else {
            initGame();
        }
    }

    // --- ENGINE DO JOGO ---

    const game = {
        
        rollDice: function() {
            if (gameState.waitingAction) return;

            const player = gameState.players[gameState.turnIndex];
            
            // Regra da Cadeia
            if (player.preso) {
                // Se j√° tentou 3x, libera na 4¬™
                if (player.attempts >= 3) {
                    player.preso = false;
                    player.attempts = 0;
                    log(`${player.nome} liberado por excesso de pena!`, true);
                    this.executeMove(player); // Joga normal
                } else {
                    // Mostra bot√µes de cadeia
                    log(`${player.nome} est√° PRESO. Escolha a√ß√£o.`);
                    document.getElementById('btn-roll').classList.add('hidden');
                    document.getElementById('btn-pay').classList.remove('hidden');
                    document.getElementById('btn-try').classList.remove('hidden');
                    return;
                }
            } else {
                this.executeMove(player);
            }
        },

        executeMove: function(player) {
            const d1 = Math.ceil(Math.random() * 6);
            const d2 = Math.ceil(Math.random() * 6);
            const total = d1 + d2;

            document.getElementById('dice-result').innerText = `Dados: ${d1} + ${d2} = ${total}`;
            log(`${player.nome} tirou ${total}.`);

            // Mover visualmente (instant√¢neo por simplicidade)
            const oldPos = player.pos;
            player.pos = (player.pos + total) % 16;

            // Regra do Sal√°rio
            if (player.pos < oldPos) {
                player.saldo += CONFIG.salario;
                log(`Passou no Marco Zero: +R$${CONFIG.salario}`);
            }

            renderBoardTokens();
            updateUI();

            // Resolver Casa
            this.handleTile(player, total);
        },

        handleTile: function(player, diceTotal) {
            const tile = BOARD_MAP[player.pos];
            log(`Caiu em: ${tile.nome}`);

            if (tile.tipo === 'va_cadeia') {
                player.pos = 8; // √çndice da cadeia
                player.preso = true;
                player.attempts = 0;
                log("Foi PRESO! Direto para o An√≠bal Bruno.", true);
                renderBoardTokens();
                this.finishAction();
                return;
            }

            if (tile.tipo === 'imposto') {
                const taxa = Math.floor(player.saldo * CONFIG.impostoRate);
                player.saldo -= taxa;
                log(`Le√£o mordeu R$${taxa} (10%)`);
                this.finishAction();
                return;
            }

            if (tile.tipo === 'sorte') {
                const val = [-50, 50, -100, 100, 200][Math.floor(Math.random()*5)];
                player.saldo += val;
                log(`Sorte/Rev√©s: ${val > 0 ? 'Ganhou' : 'Perdeu'} R$${Math.abs(val)}`);
                this.finishAction();
                return;
            }

            if (['prop', 'transporte', 'cia'].includes(tile.tipo)) {
                const ownerId = gameState.properties[tile.id];

                if (ownerId === undefined) {
                    // Compra
                    if (player.saldo >= tile.preco) {
                        this.showBuyModal(tile);
                    } else {
                        log(`Sem dinheiro para comprar ${tile.nome}.`);
                        this.finishAction();
                    }
                } else if (ownerId === player.id) {
                    log("Visitando propriedade pr√≥pria.");
                    this.finishAction();
                } else {
                    // Aluguel
                    let rent = tile.aluguel;
                    if (tile.tipo === 'cia') rent = diceTotal * 10;

                    const owner = gameState.players[ownerId];
                    log(`Propriedade de ${owner.nome}. Aluguel: R$${rent}`, true);
                    
                    player.saldo -= rent;
                    owner.saldo += rent;
                    
                    if (player.saldo < 0) {
                        log(`${player.nome} FALIU!`, true);
                        player.falido = true;
                    }
                    this.finishAction();
                }
            } else {
                this.finishAction();
            }
        },

        finishAction: function() {
            document.getElementById('btn-roll').disabled = true;
            document.getElementById('btn-pass').disabled = false;
            updateUI();
        },

        nextTurn: function() {
            document.getElementById('btn-pass').disabled = true;
            document.getElementById('btn-roll').disabled = false;
            document.getElementById('btn-roll').classList.remove('hidden');
            document.getElementById('btn-pay').classList.add('hidden');
            document.getElementById('btn-try').classList.add('hidden');
            document.getElementById('dice-result').innerText = "Dados: --";

            // Encontrar pr√≥ximo n√£o falido
            let loops = 0;
            do {
                gameState.turnIndex = (gameState.turnIndex + 1) % gameState.players.length;
                loops++;
            } while (gameState.players[gameState.turnIndex].falido && loops < 10);

            if (loops >= 10) { alert("Fim de Jogo!"); return; }

            const p = gameState.players[gameState.turnIndex];
            log(`--- Vez de ${p.nome} ---`);
            updateUI();
        },

        // --- CADEIA ---
        payJail: function() {
            const p = gameState.players[gameState.turnIndex];
            if (p.saldo >= CONFIG.fianca) {
                p.saldo -= CONFIG.fianca;
                p.preso = false;
                p.attempts = 0;
                log("Fian√ßa Paga! Jogando dados...");
                
                // Restaura bot√µes
                document.getElementById('btn-pay').classList.add('hidden');
                document.getElementById('btn-try').classList.add('hidden');
                document.getElementById('btn-roll').classList.remove('hidden');
                
                this.executeMove(p);
            } else {
                log("Sem dinheiro para fian√ßa!");
            }
        },

        tryJailDice: function() {
            const p = gameState.players[gameState.turnIndex];
            const d1 = Math.ceil(Math.random() * 6);
            const d2 = Math.ceil(Math.random() * 6);
            document.getElementById('dice-result').innerText = `Tentativa: ${d1}, ${d2}`;

            if (d1 === d2) {
                log("DOUBLE! Saiu da cadeia!", true);
                p.preso = false;
                p.attempts = 0;
                
                // Restaura bot√µes
                document.getElementById('btn-pay').classList.add('hidden');
                document.getElementById('btn-try').classList.add('hidden');
                document.getElementById('btn-roll').classList.remove('hidden');

                // Move
                const total = d1 + d2;
                p.pos = (p.pos + total) % 16;
                renderBoardTokens();
                updateUI();
                this.handleTile(p, total);

            } else {
                p.attempts++;
                log(`Falhou! (${p.attempts}/3 tentativas)`);
                if (p.attempts >= 3) {
                    log("Na pr√≥xima rodada sair√° livre.");
                }
                this.finishAction();
            }
        },

        // --- COMPRA ---
        showBuyModal: function(tile) {
            gameState.waitingAction = true;
            document.getElementById('action-modal').style.display = 'block';
            document.getElementById('modal-msg').innerText = `Comprar ${tile.nome} por R$${tile.preco}?`;
            
            const btns = document.getElementById('modal-btns');
            btns.innerHTML = '';
            
            const btnYes = document.createElement('button');
            btnYes.innerText = 'COMPRAR';
            btnYes.className = 'btn';
            btnYes.onclick = () => {
                const p = gameState.players[gameState.turnIndex];
                p.saldo -= tile.preco;
                p.props.push(tile.id);
                gameState.properties[tile.id] = p.id;
                log(`Comprou ${tile.nome}!`, true);
                this.closeModal();
                this.finishAction();
            };

            const btnNo = document.createElement('button');
            btnNo.innerText = 'PASSAR';
            btnNo.className = 'btn';
            btnNo.style.background = '#e74c3c';
            btnNo.onclick = () => {
                log("Decidiu n√£o comprar.");
                this.closeModal();
                this.finishAction();
            };

            btns.appendChild(btnYes);
            btns.appendChild(btnNo);
        },

        closeModal: function() {
            document.getElementById('action-modal').style.display = 'none';
            gameState.waitingAction = false;
        }
    };

    // --- RENDERIZADORES ---

    function initGame() {
        document.getElementById('draft-screen').classList.add('hidden');
        document.getElementById('game-container').classList.remove('hidden');
        
        // Gerar c√≥digo visual
        const codes = ["OXENTE", "MANGUE", "TUBARAO", "RECIFE"];
        document.getElementById('room-code').innerText = "SALA: " + codes[Math.floor(Math.random()*codes.length)] + Math.floor(Math.random()*99);

        // Gerar tabuleiro HTML
        const board = document.getElementById('board-grid');
        board.innerHTML = '';
        BOARD_MAP.forEach(tile => {
            const div = document.createElement('div');
            div.className = 'tile';
            div.style.gridArea = tile.grid; // M√°gica do CSS Grid
            div.style.backgroundColor = tile.cor; // Somente cabe√ßalho ou tudo? Vamos pintar fundo fraco
            
            // Ajuste visual para propriedades
            if (tile.tipo === 'prop' || tile.tipo === 'cia' || tile.tipo === 'transporte') {
                 div.innerHTML = `
                    <div class="tile-header" style="background:${tile.cor}"></div>
                    <div class="tile-name">${tile.nome}</div>
                    <div class="tile-price">R$${tile.preco}</div>
                    <div class="owner-marker" id="owner-${tile.id}"></div>
                 `;
            } else {
                div.style.backgroundColor = tile.cor;
                if(tile.textColor) div.style.color = tile.textColor;
                div.innerHTML = `<div class="tile-name" style="margin-top:20px;">${tile.nome}</div>`;
            }
            // Container para pe√µes
            div.innerHTML += `<div id="tile-tokens-${tile.id}" style="position:absolute; bottom:5px; width:100%; display:flex; justify-content:center; gap:2px;"></div>`;
            
            board.appendChild(div);
        });

        renderBoardTokens();
        updateUI();
    }

    function renderBoardTokens() {
        // Limpar todos
        for (let i = 0; i < 16; i++) {
            document.getElementById(`tile-tokens-${i}`).innerHTML = '';
        }

        gameState.players.forEach(p => {
            if (p.falido) return;
            const container = document.getElementById(`tile-tokens-${p.pos}`);
            const token = document.createElement('div');
            token.className = 'player-token';
            token.style.backgroundColor = p.color;
            token.innerText = p.icon;
            container.appendChild(token);
        });

        // Atualizar marcadores de dono (Bordas coloridas)
        for(let tileId in gameState.properties) {
            const ownerId = gameState.properties[tileId];
            const owner = gameState.players[ownerId];
            const marker = document.getElementById(`owner-${tileId}`);
            if(marker) {
                marker.style.width = "100%";
                marker.style.height = "5px";
                marker.style.background = owner.color;
            }
        }
    }

    function updateUI() {
        const list = document.getElementById('player-list');
        list.innerHTML = '';
        
        gameState.players.forEach((p, idx) => {
            const div = document.createElement('div');
            div.className = `player-card ${idx === gameState.turnIndex ? 'active' : ''} ${p.preso ? 'preso' : ''} ${p.falido ? 'falido' : ''}`;
            div.innerHTML = `
                <div>
                    <strong style="color:${p.color}">${p.icon} ${p.nome}</strong><br>
                    <small>Pos: ${BOARD_MAP[p.pos].nome}</small>
                </div>
                <div style="text-align:right">
                    R$ ${p.saldo}<br>
                    ${p.preso ? '<small style="color:red">[PRESO]</small>' : ''}
                </div>
            `;
            list.appendChild(div);
        });
    }

    function log(msg, important = false) {
        const box = document.getElementById('game-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry' + (important ? ' important' : '');
        entry.innerText = msg;
        box.appendChild(entry);
        box.scrollTop = box.scrollHeight;
    }

</script>
</body>
</html>
