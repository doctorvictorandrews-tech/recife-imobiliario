<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Recife V26: Vida e Cores</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rye&family=Poppins:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --frevo-blue: #0288d1; --frevo-green: #2e7d32; --frevo-red: #c62828; --frevo-yellow: #fbc02d;
            --wood-tex: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            --paper-tex: url('https://www.transparenttextures.com/patterns/cream-paper.png');
        }
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: #5d4037 var(--wood-tex); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* LAYOUT PRINCIPAL */
        #main-stage { display: flex; flex: 1; height: 100%; position: relative; }
        
        /* TABULEIRO 3D */
        #viewport { flex: 1; display: flex; align-items: center; justify-content: center; perspective: 1200px; overflow: hidden; }
        #board {
            display: grid; grid-template-columns: repeat(11, 85px); grid-template-rows: repeat(11, 85px);
            background: #f5f5f5; border: 15px solid #3e2723; border-radius: 10px;
            transform: rotateX(25deg) scale(0.9); transform-style: preserve-3d;
            box-shadow: 0 50px 80px rgba(0,0,0,0.6); position: relative;
        }

        .space { 
            border: 1px solid rgba(0,0,0,0.15); background: #fff; font-size: 0.65rem; text-align: center; 
            font-weight: bold; position: relative; display: flex; flex-direction: column; 
            transition: 0.2s; box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }
        .space:hover { transform: translateZ(10px); z-index: 10; border: 2px solid var(--frevo-yellow); }
        .color-strip { height: 20%; border-bottom: 2px solid #333; }
        .space-name { flex: 1; display: flex; align-items: center; justify-content: center; padding: 2px; line-height: 1; }
        .space-price { font-size: 0.6rem; color: #666; margin-bottom: 2px; }

        /* PE√ïES */
        .token {
            width: 40px; height: 40px; position: absolute; z-index: 50; font-size: 2.5rem;
            text-align: center; line-height: 40px; transition: top 0.3s ease-out, left 0.3s ease-out;
            filter: drop-shadow(0 5px 2px rgba(0,0,0,0.5)); pointer-events: none;
        }
        .token.active { filter: drop-shadow(0 0 10px var(--frevo-yellow)); transform: scale(1.2); z-index: 60; }

        /* HUD LATERAL */
        #sidebar { 
            width: 350px; background: #fff var(--paper-tex); border-left: 8px solid #3e2723; 
            padding: 20px; display: flex; flex-direction: column; z-index: 100; box-shadow: -10px 0 30px rgba(0,0,0,0.5); 
        }
        .hud-title { font-family: 'Rye'; font-size: 2rem; color: var(--frevo-red); text-align: center; margin: 0 0 20px 0; text-shadow: 1px 1px 0 #000; }
        
        .player-card { 
            background: #fff; border: 2px solid #333; border-radius: 8px; padding: 10px; margin-bottom: 10px; 
            display: flex; justify-content: space-between; align-items: center; box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }
        .player-card.turn { background: #fff9c4; border-color: var(--frevo-yellow); transform: scale(1.02); }
        .money-badge { font-family: 'Rye'; color: var(--frevo-green); font-size: 1.2rem; }

        .action-panel { margin-top: auto; display: grid; gap: 10px; }
        .btn-game { 
            padding: 15px; border: 3px solid #000; border-radius: 50px; font-weight: 900; 
            font-family: 'Rye'; text-transform: uppercase; cursor: pointer; font-size: 1rem;
            box-shadow: 0 5px 0 rgba(0,0,0,0.3); transition: 0.1s; color: white;
        }
        .btn-game:active { transform: translateY(4px); box-shadow: 0 0 0; }
        .btn-game:disabled { background: #aaa !important; cursor: not-allowed; box-shadow: none; opacity: 0.5; transform: none; }

        /* POPUP DE EVENTOS (CARTAS/COMPRA) */
        #event-modal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 5000; 
            display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .cordel-card {
            width: 320px; background: #fff var(--paper-tex); border: 8px solid #3e2723; border-radius: 10px;
            padding: 20px; text-align: center; animation: flipIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8); position: relative;
        }
        .cordel-card::before {
            content: ''; position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 20px; background: #3e2723; border-radius: 50%;
        }
        .card-img { font-size: 4rem; display: block; margin: 10px 0; }
        .card-title { font-family: 'Rye'; font-size: 1.8rem; color: var(--frevo-red); margin: 0; }
        .card-desc { font-size: 1.1rem; margin: 15px 0; font-weight: bold; color: #333; }
        .card-price { font-size: 2rem; color: var(--frevo-green); font-family: 'Rye'; display: block; margin: 10px 0; }
        
        .modal-btns { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }

        @keyframes flipIn { 0% { transform: rotateY(90deg) scale(0.5); opacity: 0; } 100% { transform: rotateY(0deg) scale(1); opacity: 1; } }

        /* DADOS 3D */
        #dice-stage { position: absolute; top: 20%; left: 50%; transform: translateX(-50%); pointer-events: none; z-index: 200; display: none; gap: 40px; }
        .cube { width: 80px; height: 80px; position: relative; transform-style: preserve-3d; transition: transform 1s ease-out; }
        .face { position: absolute; inset: 0; background: #fff; border: 4px solid #000; border-radius: 12px; display: grid; place-items: center; font-size: 2rem; font-weight: bold; backface-visibility: hidden; }
        
        .f1 { transform: translateZ(40px); } .f6 { transform: rotateX(180deg) translateZ(40px); }
        .f2 { transform: rotateY(-90deg) translateZ(40px); } .f5 { transform: rotateY(90deg) translateZ(40px); }
        .f3 { transform: rotateX(-90deg) translateZ(40px); } .f4 { transform: rotateX(90deg) translateZ(40px); }
        
        .show-1 { transform: rotateX(0deg) rotateY(0deg); } .show-6 { transform: rotateX(180deg); }
        .show-2 { transform: rotateY(90deg); } .show-5 { transform: rotateY(-90deg); }
        .show-3 { transform: rotateX(90deg); } .show-4 { transform: rotateX(-90deg); }

        .toast { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 10px 20px; border-radius: 20px; z-index: 9999; animation: fadeUp 2s forwards; }
        @keyframes fadeUp { 0% { opacity: 0; transform: translate(-50%, 20px); } 20% { opacity: 1; transform: translate(-50%, 0); } 80% { opacity: 1; } 100% { opacity: 0; } }
    </style>
</head>
<body>

<div id="main-stage">
    <div id="viewport">
        <div id="board">
            <div id="center-logo" style="grid-column:2/11; grid-row:2/11; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                <h1 style="font-family:'Rye'; font-size:4rem; color:var(--frevo-blue); margin:0; text-shadow:2px 2px #fff;">RECIFE</h1>
                <div style="background:#fff; padding:5px 15px; border-radius:20px; font-weight:bold; border:2px solid #000;">‚òÄÔ∏è Sol</div>
            </div>
        </div>
    </div>

    <div id="sidebar">
        <h1 class="hud-title">PERNAMBUCO</h1>
        <div id="players-list">
            </div>
        <div style="flex:1; background:rgba(0,0,0,0.05); border:1px dashed #999; padding:10px; margin-bottom:10px; overflow-y:auto;" id="log-box">
            <div style="font-size:0.8rem; color:#666;">Bem-vindo ao Recife!</div>
        </div>
        <div class="action-panel">
            <button id="btn-roll" class="btn-game" style="background:var(--frevo-yellow); color:#000;">üé≤ ROLAR</button>
            <button id="btn-pass" class="btn-game" style="background:var(--frevo-red);" disabled>üõë PASSAR</button>
        </div>
    </div>
</div>

<div id="dice-stage">
    <div id="d1" class="cube"><div class="face f1">1</div><div class="face f2">2</div><div class="face f3">3</div><div class="face f4">4</div><div class="face f5">5</div><div class="face f6">6</div></div>
    <div id="d2" class="cube"><div class="face f1">1</div><div class="face f2">2</div><div class="face f3">3</div><div class="face f4">4</div><div class="face f5">5</div><div class="face f6">6</div></div>
</div>

<div id="event-modal">
    <div class="cordel-card">
        <span class="card-img" id="mod-icon">üè†</span>
        <h2 class="card-title" id="mod-title">TITULO</h2>
        <p class="card-desc" id="mod-desc">Descri√ß√£o do evento</p>
        <div class="modal-btns" id="mod-btns"></div>
    </div>
</div>

<script>
/* CONFIGURA√á√ÉO */
const BD = [
    {t:'st',n:'In√≠cio'}, {t:'pr',g:'#795548',n:'Coque',p:60}, {t:'ch',n:'Sorte'}, {t:'pr',g:'#795548',n:'Ibura',p:60}, {t:'tx',n:'IPTU',p:200}, {t:'rr',n:'Metr√¥'}, {t:'pr',g:'#03a9f4',n:'Santo Amaro',p:100}, {t:'ch',n:'Rev√©s'}, {t:'pr',g:'#03a9f4',n:'Afogados',p:100}, {t:'pr',g:'#03a9f4',n:'Mustardinha',p:120},
    {t:'jl',n:'Cadeia'}, {t:'pr',g:'#e91e63',n:'Iputinga',p:140}, {t:'ut',n:'Neoenergia',p:150}, {t:'pr',g:'#e91e63',n:'Cordeiro',p:140}, {t:'pr',g:'#e91e63',n:'V√°rzea',p:160}, {t:'rr',n:'Metr√¥ Oeste'}, {t:'pr',g:'#ff5722',n:'Imbiribeira',p:180}, {t:'ch',n:'Sorte'}, {t:'pr',g:'#ff5722',n:'Encruzilhada',p:180}, {t:'pr',g:'#ff5722',n:'Torre',p:200},
    {t:'pk',n:'Parque'}, {t:'pr',g:'#d32f2f',n:'Aflitos',p:220}, {t:'ch',n:'Rev√©s'}, {t:'pr',g:'#d32f2f',n:'Espinheiro',p:220}, {t:'pr',g:'#d32f2f',n:'Madalena',p:240}, {t:'rr',n:'Via Mangue'}, {t:'pr',g:'#fbc02d',n:'Gra√ßas',p:260}, {t:'pr',g:'#fbc02d',n:'Po√ßo',p:260}, {t:'ut',n:'Compesa',p:150}, {t:'pr',g:'#fbc02d',n:'Casa Forte',p:280},
    {t:'gj',n:'Blitz'}, {t:'pr',g:'#388e3c',n:'Apipucos',p:300}, {t:'pr',g:'#388e3c',n:'Parnamirim',p:300}, {t:'ch',n:'Sorte'}, {t:'pr',g:'#388e3c',n:'Paiva',p:320}, {t:'rr',n:'Aeroporto'}, {t:'ch',n:'Rev√©s'}, {t:'pr',g:'#1565c0',n:'Boa Viagem',p:350}, {t:'tx',n:'Taxa',p:100}, {t:'pr',g:'#1565c0',n:'Jaqueira',p:400}
];

const CARDS_SORTE = [
    "Achou 20 conto no Marco Zero! (+$20)",
    "Ganhou na rifa do Galo! (+$100)",
    "Vendeu √°gua no carnaval. Lucro! (+$50)"
];
const CARDS_REVES = [
    "Perdeu a carteira no √¥nibus. (-$50)",
    "Multa de tr√¢nsito na Agamenon. (-$100)",
    "Pneu furou na chuva. (-$30)"
];

const PLAYERS = [
    {name:"Voc√™", color:"red", icon:"ü¶Ä", pos:0, money:1500, jailed:false, id:0},
    {name:"Z√© (IA)", color:"blue", icon:"ü¶à", pos:0, money:1500, jailed:false, id:1}
];

let turn = 0;
let props = Array(40).fill(null); // Owner index
let rolled = false;
let animating = false;

const SFX = {
    step: new Audio('https://www.soundjay.com/misc/sounds/wood-block-1.mp3'),
    cash: new Audio('https://www.soundjay.com/misc/sounds/coins-in-hand-2.mp3'),
    win: new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3')
};

/* INICIALIZA√á√ÉO */
function init() {
    drawBoard();
    updateHUD();
}

function drawBoard() {
    const b = document.getElementById('board');
    BD.forEach((s, i) => {
        const d = document.createElement('div');
        d.className = 'space'; d.id = `s${i}`;
        
        let r, c;
        if (i<=10) { r=11; c=11-i; }
        else if (i<=20) { r=11-(i-10); c=1; }
        else if (i<=30) { r=1; c=1+(i-20); }
        else { r=1+(i-30); c=11; }
        d.style.gridRow = r; d.style.gridColumn = c;

        if (s.t === 'pr') {
            d.innerHTML = `<div class="color-strip" style="background:${s.g}"></div><div class="space-name">${s.n}</div><div class="space-price">$${s.p}</div>`;
        } else {
            d.innerHTML = `<div class="space-name" style="margin:auto">${s.n}</div>`;
        }
        b.appendChild(d);
    });
    
    // Create Tokens
    PLAYERS.forEach((p, i) => {
        const t = document.createElement('div');
        t.className = 'token'; t.id = `tok${i}`;
        t.innerText = p.icon;
        b.appendChild(t);
        placeToken(i, 0); // Start at 0
    });
}

function placeToken(pid, pos) {
    const t = document.getElementById(`tok${pid}`);
    const cell = document.getElementById(`s${pos}`);
    const br = document.getElementById('board').getBoundingClientRect();
    const cr = cell.getBoundingClientRect();
    
    // Offset for multiple players
    const offX = pid * 8; 
    const offY = pid * 8;

    // Calculate relative position inside the board container
    // Since board is transformed 3D, we use simple grid math for stability or precise offsets
    // Simplified logic: stick to the cell visually
    // Better approach: append token INTO cell? No, z-index issues.
    // Let's use simple style overrides.
    
    // Reset transform to avoid accumulation
    t.style.left = (cell.offsetLeft + 10 + offX) + 'px';
    t.style.top = (cell.offsetTop + 10 + offY) + 'px';
}

/* LOGICA DO JOGO */
async function rollDice() {
    if (animating || rolled) return;
    animating = true;
    
    // Roll Math
    const d1 = Math.ceil(Math.random()*6);
    const d2 = Math.ceil(Math.random()*6);
    const total = d1 + d2;

    // Animation
    const diceBox = document.getElementById('dice-stage');
    diceBox.style.display = 'flex';
    const c1 = document.getElementById('d1');
    const c2 = document.getElementById('d2');
    
    // Reset classes
    c1.className = 'cube'; c2.className = 'cube';
    void c1.offsetWidth; // Reflow
    
    // Apply visual rotation
    setTimeout(() => { c1.classList.add(`show-${d1}`); c2.classList.add(`show-${d2}`); }, 50);

    await sleep(2000); // Wait for animation
    diceBox.style.display = 'none';
    
    await movePawn(turn, total);
    
    // Turn Logic
    rolled = true;
    checkButtons();
    animating = false;
}

async function movePawn(pid, steps) {
    const p = PLAYERS[pid];
    
    for (let i = 0; i < steps; i++) {
        p.pos++;
        if (p.pos >= 40) {
            p.pos = 0;
            p.money += 200;
            log(`${p.name} passou no in√≠cio: +$200`);
            playSound('win');
        }
        placeToken(pid, p.pos);
        playSound('step');
        await sleep(200); // "Poc-Poc" effect
    }
    
    handleLanding(pid);
    updateHUD();
}

function handleLanding(pid) {
    const p = PLAYERS[pid];
    const s = BD[p.pos];
    const owner = props[p.pos];

    if (s.t === 'pr' || s.t === 'rr' || s.t === 'ut') {
        if (owner === null) {
            // Unowned - Offer to Buy (Only if Human)
            if (pid === 0) {
                if (p.money >= s.p) showModal('buy', s);
                else toast("Dinheiro insuficiente para comprar.");
            } else {
                // AI Logic
                if (p.money >= s.p + 200) buyProp(pid); // AI buys if safe
            }
        } else if (owner !== pid) {
            // Pay Rent
            const rent = Math.floor(s.p * 0.1);
            p.money -= rent;
            PLAYERS[owner].money += rent;
            log(`${p.name} pagou aluguel de $${rent} a ${PLAYERS[owner].name}`);
            playSound('cash');
        }
    } else if (s.t === 'ch') {
        drawCard('sorte');
    } else if (s.t === 'rev') {
        drawCard('reves');
    } else if (s.t === 'tx') {
        p.money -= s.p;
        log(`${p.name} pagou taxa de $${s.p}`);
    }
}

function drawCard(type) {
    const deck = type === 'sorte' ? CARDS_SORTE : CARDS_REVES;
    const txt = deck[Math.floor(Math.random() * deck.length)];
    const val = parseInt(txt.match(/\d+/)[0]);
    const isGain = txt.includes('+');
    
    showModal('card', { title: type.toUpperCase(), desc: txt, type: type });
    
    const p = PLAYERS[turn];
    if (isGain) { p.money += val; playSound('win'); }
    else { p.money -= val; }
}

function showModal(type, data) {
    const m = document.getElementById('event-modal');
    const icon = document.getElementById('mod-icon');
    const title = document.getElementById('mod-title');
    const desc = document.getElementById('mod-desc');
    const btns = document.getElementById('mod-btns');
    
    m.style.display = 'flex';
    btns.innerHTML = '';

    if (type === 'buy') {
        icon.innerText = 'üè†';
        title.innerText = data.n;
        desc.innerHTML = `Pre√ßo: <span class="card-price">$${data.p}</span><br>Deseja comprar?`;
        
        const bYes = document.createElement('button');
        bYes.className = 'btn-game'; bYes.style.background = '#2e7d32'; bYes.innerText = 'SIM';
        bYes.onclick = () => { buyProp(turn); closeModal(); };
        
        const bNo = document.createElement('button');
        bNo.className = 'btn-game'; bNo.style.background = '#c62828'; bNo.innerText = 'N√ÉO';
        bNo.onclick = () => { closeModal(); }; // In real game, auction
        
        btns.appendChild(bYes); btns.appendChild(bNo);
    } 
    else if (type === 'card') {
        icon.innerText = data.type === 'sorte' ? 'üçÄ' : '‚ö†Ô∏è';
        title.innerText = data.title;
        desc.innerText = data.desc;
        
        const bOk = document.createElement('button');
        bOk.className = 'btn-game'; bOk.style.background = '#0288d1'; bOk.innerText = 'OK';
        bOk.onclick = closeModal;
        btns.appendChild(bOk);
        
        if (data.type === 'sorte') confetti();
    }
}

function closeModal() {
    document.getElementById('event-modal').style.display = 'none';
    updateHUD();
}

function buyProp(pid) {
    const p = PLAYERS[pid];
    const s = BD[p.pos];
    p.money -= s.p;
    props[p.pos] = pid;
    
    // Visual Marker
    document.getElementById(`s${p.pos}`).style.border = `4px solid ${p.color}`;
    log(`${p.name} comprou ${s.n}!`);
    playSound('cash');
    updateHUD();
}

function passTurn() {
    if (!rolled) return;
    turn = (turn + 1) % PLAYERS.length;
    rolled = false;
    log(`Vez de: ${PLAYERS[turn].name}`);
    checkButtons();
    updateHUD();
    
    if (turn === 1) setTimeout(aiTurn, 1000);
}

async function aiTurn() {
    await rollDice();
    await sleep(1000);
    passTurn();
}

/* UI UTILS */
function updateHUD() {
    const list = document.getElementById('players-list');
    list.innerHTML = PLAYERS.map((p, i) => `
        <div class="player-card ${turn === i ? 'turn' : ''}">
            <div style="font-size:1.5rem;">${p.icon}</div>
            <div>${p.name}</div>
            <div class="money-badge">$${p.money}</div>
        </div>
    `).join('');
    
    checkButtons();
}

function checkButtons() {
    const isHuman = turn === 0;
    document.getElementById('btn-roll').disabled = !(isHuman && !rolled);
    document.getElementById('btn-pass').disabled = !(isHuman && rolled);
}

function log(msg) {
    const box = document.getElementById('log-box');
    box.innerHTML += `<div>> ${msg}</div>`;
    box.scrollTop = box.scrollHeight;
}

function toast(msg) {
    const t = document.createElement('div');
    t.className = 'toast'; t.innerText = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 2000);
}

function playSound(type) {
    try { SFX[type].currentTime = 0; SFX[type].play(); } catch(e){}
}

const sleep = ms => new Promise(r => setTimeout(r, ms));

/* EVENTOS */
document.getElementById('btn-roll').onclick = rollDice;
document.getElementById('btn-pass').onclick = passTurn;

// Start
init();

</script>
</body>
</html>
